(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{295:function(t,i,a){"use strict";a.r(i);a.d(i,"default",function(){return s});function e(t,i){for(var a=0;a<i.length;a++){var e=i[a];e.enumerable=e.enumerable||false;e.configurable=true;if("value"in e)e.writable=true;Object.defineProperty(t,e.key,e)}}function n(t,i,a){if(i)e(t.prototype,i);if(a)e(t,a);return t}function h(t,i){if(!(t instanceof i)){throw new TypeError("Cannot call a class as a function")}}var r=function t(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{r:0,g:.5,b:1,a:.25};h(this,t);Object.assign(this,i)};var o=function(){function i(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{x:0,y:0,z:64,radius:128,r:1,g:.8,b:.4,a:1};h(this,i);Object.assign(this,t)}n(i,[{key:"attenuateDistance",value:function t(i){var a=i/this.radius;return 1/(a*a)}}]);return i}();function H(t,i,a,e,n,s){return t*e+i*n+a*s}function O(t,i,a){return Math.sqrt(t*t+i*i+a*a)}var s=function(){function s(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:256;var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:256;var e=arguments.length>3?arguments[3]:undefined;var n=arguments.length>4?arguments[4]:undefined;h(this,s);this.canvas=t;this.canvas.style.imageRendering="pixelated";this.canvas.width=i;this.canvas.height=a;this.canvas.centerX=i/2;this.canvas.centerY=a/2;this.context2D=this.canvas.getContext("2d");this.context2D.imageSmoothingEnabled=false;this.buffer=this.context2D.createImageData(i,a);this.ambientLight=new r;this.pointLight=new o;this.texture={image:new window.Image,normalMap:new window.Image};this.texture.image.src=e;this.texture.image.onload=this.loadHandler.bind(this);this.texture.normalMap.src=n;this.texture.normalMap.onload=this.loadHandler.bind(this);this.imagesLoaded=0;this.running=true}n(s,[{key:"loadHandler",value:function t(){if(++this.imagesLoaded===2){this.context2D.drawImage(this.texture.image,0,0,this.canvas.width,this.canvas.height);var i=this.context2D.getImageData(0,0,this.canvas.width,this.canvas.height);this.texture.diffuse=new Float32Array(i.data);for(var a=0;a<this.texture.diffuse.length;a+=4){this.texture.diffuse[a]/=255;this.texture.diffuse[a+1]/=255;this.texture.diffuse[a+2]/=255;this.texture.diffuse[a+3]=1}this.context2D.drawImage(this.texture.normalMap,0,0,this.canvas.width,this.canvas.height);var e=this.context2D.getImageData(0,0,this.canvas.width,this.canvas.height);this.texture.normals=new Float32Array(e.data);for(var n=0;n<this.texture.normals.length;n+=4){var s=this.texture.normals[n]/255*2-1;var h=this.texture.normals[n+1]/255*2-1;var r=this.texture.normals[n+2]/255*2-1;var o=O(s,h,r);this.texture.normals[n]=s/o;this.texture.normals[n+1]=h/o;this.texture.normals[n+2]=r/o;this.texture.normals[n+3]=1}this.update()}}},{key:"stop",value:function t(){this.running=false}},{key:"update",value:function t(){var i=window.performance.now()*5e-4;this.pointLight.x=this.canvas.centerX+Math.sin(i)*this.canvas.centerX;this.pointLight.y=this.canvas.centerY+Math.cos(i)*this.canvas.centerY;var a=this.texture,e=a.diffuse,n=a.normals;var s=this.buffer.data;for(var h=0;h<s.length;h+=4){var r=e[h];var o=e[h+1];var u=e[h+2];var c=n[h];var v=n[h+1];var g=n[h+2];var f=h>>2;var d=f%this.canvas.width;var l=f/this.canvas.width>>0;var m=this.pointLight.x-d;var x=this.pointLight.y-l;var p=this.pointLight.z;var w=O(m,x,p);m/=w;x/=w;p/=w;var b=H(m,x,p,c,v,g);var L=b<0?0:b;var D=this.pointLight.attenuateDistance(w);var y=L*D;var I=this.pointLight.r*this.pointLight.a*y;var M=this.pointLight.g*this.pointLight.a*y;var k=this.pointLight.b*this.pointLight.a*y;var j=this.ambientLight.r*this.ambientLight.a;var A=this.ambientLight.g*this.ambientLight.a;var F=this.ambientLight.b*this.ambientLight.a;s[h]=r*(j+I)*255;s[h+1]=o*(A+M)*255;s[h+2]=u*(F+k)*255;s[h+3]=255}this.context2D.putImageData(this.buffer,0,0);this.context2D.fillStyle="#fff4";this.context2D.beginPath();this.context2D.arc(this.pointLight.x,this.pointLight.y,5,0,Math.PI<<1);this.context2D.fill();if(this.running){window.requestAnimationFrame(this.update.bind(this))}}}]);return s}()}}]);